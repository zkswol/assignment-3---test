<div class="inventory-container">
  <div class="header">
    <div class="header-left">
      <button (click)="goBack()" class="btn-back">‚Üê Back to Dashboard</button>
      <h2>Inventory Management</h2>
    </div>
    <div class="header-actions">
      <button (click)="refreshInventory()" [disabled]="loading()">Refresh</button>
      <a [routerLink]="['/add-inventory-34475338']" [queryParams]="{userId: user()?.userId}" class="btn-primary">Add New Item</a>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="summary-cards">
    <div class="card">
      <h3>Total Items</h3>
      <p class="number">{{ inventory().length }}</p>
    </div>
    <div class="card">
      <h3>Total Value</h3>
      <p class="number">${{ totalValue().toFixed(2) }}</p>
    </div>
    <div class="card warning">
      <h3>Expiring Soon</h3>
      <p class="number">{{ expiringItems().length }}</p>
    </div>
    <div class="card danger">
      <h3>Expired</h3>
      <p class="number">{{ expiredItems().length }}</p>
    </div>
  </div>

  <!-- Filters and Sorting -->
  <div class="filters">
    <div class="filter-group">
      <label for="category">Category:</label>
      <select id="category" [(ngModel)]="filterCategory">
        <option value="">All Categories</option>
        <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
      </select>
    </div>
    
    <div class="filter-group">
      <label for="location">Location:</label>
      <select id="location" [(ngModel)]="filterLocation">
        <option value="">All Locations</option>
        <option *ngFor="let location of locations" [value]="location">{{ location }}</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="sortBy">Sort by:</label>
      <select id="sortBy" [(ngModel)]="sortBy">
        <option value="createdDate">Date Added</option>
        <option value="ingredientName">Name</option>
        <option value="category">Category</option>
        <option value="expirationDate">Expiration Date</option>
        <option value="cost">Cost</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="sortOrder">Order:</label>
      <select id="sortOrder" [(ngModel)]="sortOrder">
        <option value="desc">Newest First</option>
        <option value="asc">Oldest First</option>
      </select>
    </div>

    <button (click)="clearFilters()" class="btn-secondary">Clear Filters</button>
  </div>

  <!-- Loading and Error States -->
  <div *ngIf="loading()" class="loading">Loading inventory...</div>
  <div *ngIf="error()" class="error">Error: {{ error() }}</div>

  <!-- Inventory Table -->
  <div *ngIf="!loading() && !error()" class="inventory-table">
    <table>
      <thead>
        <tr>
          <th>Ingredient</th>
          <th>Quantity</th>
          <th>Category</th>
          <th>Location</th>
          <th>Purchase Date</th>
          <th>Expiration Date</th>
          <th>Cost</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of filteredInventory" [class]="getExpirationClass(item.expirationDate)">
          <td>{{ item.ingredientName }}</td>
          <td>{{ item.quantity }} {{ item.unit }}</td>
          <td>{{ item.category }}</td>
          <td>{{ item.location }}</td>
          <td>{{ item.purchaseDate | date:'yyyy-MM-dd' }}</td>
          <td>{{ item.expirationDate | date:'yyyy-MM-dd' }}</td>
          <td>${{ item.cost | number:'1.2-2' }}</td>
          <td>
            <span [class]="getExpirationClass(item.expirationDate)">
              {{ getExpirationStatus(item.expirationDate) }}
            </span>
          </td>
           <td>
             <a [routerLink]="['/inventory-34475338', item.inventoryId, 'edit']" [queryParams]="{userId: user()?.userId}" class="btn-edit">Edit</a>
             <button (click)="openDeleteModal(deleteModal, item.inventoryId, item.ingredientName)" class="btn-delete">Delete</button>
           </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="filteredInventory.length === 0" class="no-items">
      <p>No inventory items found.</p>
      <a [routerLink]="['/add-inventory-34475338']" [queryParams]="{userId: user()?.userId}" class="btn-primary">Add First Item</a>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<ng-template #deleteModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Delete Inventory Item</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <p>Are you sure you want to delete this inventory item?</p>
    <p><small class="text-muted">This action cannot be undone.</small></p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-danger" (click)="modal.close('yes')">Yes, Delete</button>
    <button type="button" class="btn btn-secondary" (click)="modal.close('no')">Cancel</button>
  </div>
</ng-template>
