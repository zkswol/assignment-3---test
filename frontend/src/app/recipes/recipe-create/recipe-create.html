<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div class="d-flex align-items-center gap-2">
      <button class="btn btn-outline-secondary" (click)="goBack()">‚Üê Back to Recipes</button>
      <h2 class="mb-0">Create New Recipe</h2>
    </div>
  </div>

  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
  <div *ngIf="success" class="alert alert-success">{{ success }}</div>

  <form [formGroup]="recipeForm" (ngSubmit)="onSubmit()" class="row g-3">
    <!-- Basic Information -->
    <div class="col-12">
      <h4>Basic Information</h4>
    </div>
    
    <div class="col-md-6">
      <label class="form-label">Title *</label>
      <input type="text" class="form-control" formControlName="title" placeholder="Enter recipe name">
      <div *ngIf="recipeForm.get('title')?.touched && recipeForm.get('title')?.invalid" class="text-danger">
        <small *ngIf="recipeForm.get('title')?.errors?.['required']">Title is required</small>
        <small *ngIf="recipeForm.get('title')?.errors?.['minlength']">Title must be at least 3 characters</small>
        <small *ngIf="recipeForm.get('title')?.errors?.['maxlength']">Title must be less than 50 characters</small>
      </div>
    </div>

    <div class="col-md-6">
      <label class="form-label">Chef *</label>
      <input type="text" class="form-control" formControlName="chef" placeholder="Enter chef name">
      <div *ngIf="recipeForm.get('chef')?.touched && recipeForm.get('chef')?.invalid" class="text-danger">
        <small *ngIf="recipeForm.get('chef')?.errors?.['required']">Chef name is required</small>
        <small *ngIf="recipeForm.get('chef')?.errors?.['pattern']">Chef name can only contain letters, spaces, hyphens, and apostrophes</small>
      </div>
    </div>

    <div class="col-md-6">
      <label class="form-label">Cuisine Type *</label>
      <select class="form-select" formControlName="cuisineType">
        <option value="">Select cuisine type</option>
        <option value="Italian">Italian</option>
        <option value="Asian">Asian</option>
        <option value="Mexican">Mexican</option>
        <option value="American">American</option>
        <option value="French">French</option>
        <option value="Indian">Indian</option>
        <option value="Mediterranean">Mediterranean</option>
        <option value="Other">Other</option>
      </select>
      <div *ngIf="recipeForm.get('cuisineType')?.touched && recipeForm.get('cuisineType')?.invalid" class="text-danger">
        <small>Cuisine type is required</small>
      </div>
    </div>

    <div class="col-md-6">
      <label class="form-label">Meal Type *</label>
      <select class="form-select" formControlName="mealType">
        <option value="">Select meal type</option>
        <option value="Breakfast">Breakfast</option>
        <option value="Lunch">Lunch</option>
        <option value="Dinner">Dinner</option>
        <option value="Snack">Snack</option>
        <option value="Dessert">Dessert</option>
        <option value="Appetizer">Appetizer</option>
        <option value="Beverage">Beverage</option>
      </select>
      <div *ngIf="recipeForm.get('mealType')?.touched && recipeForm.get('mealType')?.invalid" class="text-danger">
        <small>Meal type is required</small>
      </div>
    </div>

    <div class="col-md-4">
      <label class="form-label">Prep Time (minutes) *</label>
      <input type="number" class="form-control" formControlName="prepTime" min="1" max="480">
      <div *ngIf="recipeForm.get('prepTime')?.touched && recipeForm.get('prepTime')?.invalid" class="text-danger">
        <small>Prep time must be between 1 and 480 minutes</small>
      </div>
    </div>

    <div class="col-md-4">
      <label class="form-label">Difficulty *</label>
      <select class="form-select" formControlName="difficulty">
        <option value="">Select difficulty</option>
        <option value="Easy">Easy</option>
        <option value="Medium">Medium</option>
        <option value="Hard">Hard</option>
      </select>
      <div *ngIf="recipeForm.get('difficulty')?.touched && recipeForm.get('difficulty')?.invalid" class="text-danger">
        <small>Difficulty is required</small>
      </div>
    </div>

    <div class="col-md-4">
      <label class="form-label">Servings *</label>
      <input type="number" class="form-control" formControlName="servings" min="1" max="20">
      <div *ngIf="recipeForm.get('servings')?.touched && recipeForm.get('servings')?.invalid" class="text-danger">
        <small>Servings must be between 1 and 20</small>
      </div>
    </div>

    <!-- Ingredients -->
    <div class="col-12">
      <h4>Ingredients</h4>
      <div formArrayName="ingredients">
        <div *ngFor="let ingredient of ingredients.controls; let i = index" [formGroupName]="i" class="row g-2 mb-2">
          <div class="col-md-4">
            <input type="text" class="form-control" formControlName="name" placeholder="Ingredient name">
          </div>
          <div class="col-md-3">
            <input type="text" class="form-control" formControlName="quantity" step="0.1" placeholder="Quantity">
          </div>
          <div class="col-md-2">
            <button type="button" class="btn btn-outline-danger" (click)="removeIngredient(i)" [disabled]="ingredients.length === 1">Remove</button>
          </div>
        </div>
        <button type="button" class="btn btn-outline-primary" (click)="addIngredient()">+ Add Ingredient</button>
      </div>
    </div>

    <!-- Instructions -->
    <div class="col-12">
      <h4>Instructions</h4>
      <div formArrayName="instructions">
        <div *ngFor="let instruction of instructions.controls; let i = index" [formGroupName]="i" class="mb-2">
          <div class="input-group">
            <span class="input-group-text">{{ i + 1 }}.</span>
            <textarea class="form-control" formControlName="step" rows="2" placeholder="Enter instruction step"></textarea>
            <button type="button" class="btn btn-outline-danger" (click)="removeInstruction(i)" [disabled]="instructions.length === 1">Remove</button>
          </div>
        </div>
        <button type="button" class="btn btn-outline-primary" (click)="addInstruction()">+ Add Instruction</button>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="col-12">
      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary" [disabled]="loading || recipeForm.invalid">
          {{ loading ? 'Creating...' : 'Create Recipe' }}
        </button>
        <button type="button" class="btn btn-secondary" (click)="goBack()">Cancel</button>
      </div>
    </div>
  </form>
</div>
